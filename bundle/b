#!/bin/zsh

me_name=$0
cd $HOME/.vim/bundle

bfile="bundles.txt"
ufile="bundles-unix.txt"

# read file contents into array
bundles=( ${(f)"$(<$bfile)"} )
bundles+=( ${(f)"$(<$ufile)"} )


usage() {
    print "$me_name update - git pull for all bundles"
    print "$me_name get    - git clone for all specified bundles"
    print "$me_name help   - this text"
    print "$me_name check  - check for files not in *bundles.txt"
    print "$me_name echo   - print the bundles in *bundles.txt"
    print "\n standard is update"
}

get() {
    for i in $bundles[@]; do
        git clone $i
    done
}

update() {
    for i in *(/); do
        cd $i
        print $i
        git pull
        print
        cd -
    done
}

check() {
    for i in *(/); do
        cd $i
        local j=$(git config --get remote.origin.url)
        [[ ${bundles[(r)$j]} == $j ]] || echo "$i ($j) not found"
        cd -
    done
}

case $1 in
    "u" | "update" ) update ;;
    "g" | "get"    ) get    ;;
    "h" | "help"   ) usage  ;;
    "c" | "check"  ) check  ;;
    "e" | "echo"   ) print ${(F)bundles} ;;
     *             ) update ;;
esac
